<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Diagnostic</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #0f0;
            padding: 20px;
            line-height: 1.6;
        }
        h1 { color: #0ff; }
        h2 { color: #ff0; margin-top: 30px; }
        .pass { color: #0f0; }
        .fail { color: #f00; }
        .warn { color: #ff0; }
        .info { color: #0ff; }
        pre {
            background: #111;
            padding: 10px;
            border: 1px solid #0f0;
            overflow-x: auto;
        }
        button {
            background: #0f0;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 10px 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        button:hover {
            background: #0ff;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-left: 3px solid;
        }
        .test-result.pass { border-color: #0f0; background: rgba(0, 255, 0, 0.1); }
        .test-result.fail { border-color: #f00; background: rgba(255, 0, 0, 0.1); }
        #console-output {
            background: #000;
            border: 2px solid #0f0;
            padding: 15px;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üî¨ ASCII Art App - Quick Diagnostic</h1>
    <p class="info">This page will diagnose why output isn't showing</p>

    <div id="results"></div>
    
    <h2>Console Output:</h2>
    <div id="console-output"></div>

    <h2>Actions:</h2>
    <button onclick="runFullDiagnostic()">Run Full Diagnostic</button>
    <button onclick="testGeneration()">Test Generation</button>
    <button onclick="testManualDisplay()">Test Manual Display</button>
    <button onclick="clearConsole()">Clear Console</button>

    <!-- Load all application scripts -->
    <script src="core/ErrorHandler.js"></script>
    <script src="config/app.config.js"></script>
    <script src="core/EventBus.js"></script>
    <script src="modules/PerformanceOptimizer.js"></script>
    <script src="modules/FontManager.js"></script>
    <script src="modules/ASCIIRenderer.js"></script>
    <script src="modules/InputValidator.js"></script>
    <script src="services/ASCIIGeneratorService.js"></script>
    <script src="controllers/UIController.js"></script>

    <script>
        // Capture console logs
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        const consoleOutput = document.getElementById('console-output');

        function addToConsole(type, ...args) {
            const msg = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `[${type.toUpperCase()}] ${msg}`;
            consoleOutput.appendChild(div);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        console.log = (...args) => {
            originalLog(...args);
            addToConsole('info', ...args);
        };
        console.error = (...args) => {
            originalError(...args);
            addToConsole('fail', ...args);
        };
        console.warn = (...args) => {
            originalWarn(...args);
            addToConsole('warn', ...args);
        };

        function clearConsole() {
            consoleOutput.innerHTML = '';
        }

        function addResult(message, pass) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-result ${pass ? 'pass' : 'fail'}`;
            div.innerHTML = `${pass ? '‚úÖ' : '‚ùå'} ${message}`;
            results.appendChild(div);
        }

        async function runFullDiagnostic() {
            document.getElementById('results').innerHTML = '<h2>üîç Running Diagnostic...</h2>';
            
            // Test 1: Script Loading
            console.log('\n=== TEST 1: Script Loading ===');
            const scriptsLoaded = {
                EventBus: typeof EventBus !== 'undefined',
                FontManager: typeof FontManager !== 'undefined',
                ASCIIRenderer: typeof ASCIIRenderer !== 'undefined',
                InputValidator: typeof InputValidator !== 'undefined',
                ASCIIGeneratorService: typeof ASCIIGeneratorService !== 'undefined',
                UIController: typeof UIController !== 'undefined',
                AppConfig: typeof AppConfig !== 'undefined'
            };
            
            for (const [name, loaded] of Object.entries(scriptsLoaded)) {
                addResult(`${name} loaded`, loaded);
            }

            // Test 2: Create EventBus
            console.log('\n=== TEST 2: EventBus Creation ===');
            const eventBus = new EventBus();
            addResult('EventBus created', !!eventBus);

            // Test 3: EventBus event subscription
            console.log('\n=== TEST 3: EventBus Subscription ===');
            let eventReceived = false;
            eventBus.on('test:event', (data) => {
                eventReceived = true;
                console.log('Test event received:', data);
            });
            eventBus.emit('test:event', { test: 'data' });
            addResult('EventBus pub/sub working', eventReceived);

            // Test 4: Create Components
            console.log('\n=== TEST 4: Component Creation ===');
            try {
                const fontManager = new FontManager();
                const asciiRenderer = new ASCIIRenderer();
                const inputValidator = new InputValidator({});
                addResult('Core modules created', true);
                
                const service = new ASCIIGeneratorService(
                    fontManager,
                    asciiRenderer,
                    inputValidator,
                    eventBus
                );
                addResult('Service layer created', true);
            } catch (error) {
                addResult(`Component creation failed: ${error.message}`, false);
            }

            // Test 5: Check Event Listeners
            console.log('\n=== TEST 5: Event Listener Registration ===');
            console.log('Registered events:', Object.keys(eventBus.events));
            const hasTextGenListeners = !!eventBus.events[EventBus.Events.REQUEST_TEXT_GENERATION];
            const hasCompleteListeners = !!eventBus.events[EventBus.Events.TEXT_GENERATION_COMPLETE];
            addResult('REQUEST_TEXT_GENERATION has listeners', hasTextGenListeners);
            addResult('TEXT_GENERATION_COMPLETE has listeners', hasCompleteListeners);

            // Test 6: Test Generation
            console.log('\n=== TEST 6: Generation Test ===');
            let generationCompleted = false;
            eventBus.on(EventBus.Events.TEXT_GENERATION_COMPLETE, (result) => {
                generationCompleted = true;
                console.log('Generation completed! Result:', {
                    asciiLength: result.ascii?.length,
                    hasMetadata: !!result.metadata
                });
            });

            eventBus.emit(EventBus.Events.REQUEST_TEXT_GENERATION, {
                text: 'HI',
                fontName: 'standard',
                color: 'none',
                animation: 'none'
            });

            await new Promise(resolve => setTimeout(resolve, 1000));
            addResult('Generation completed', generationCompleted);

            console.log('\n=== DIAGNOSTIC COMPLETE ===');
        }

        async function testGeneration() {
            clearConsole();
            console.log('üöÄ Testing generation flow...');
            
            const eventBus = new EventBus();
            const fontManager = new FontManager();
            const asciiRenderer = new ASCIIRenderer();
            const inputValidator = new InputValidator({});
            
            const service = new ASCIIGeneratorService(
                fontManager,
                asciiRenderer,
                inputValidator,
                eventBus
            );

            eventBus.on(EventBus.Events.TEXT_GENERATION_COMPLETE, (result) => {
                console.log('‚úÖ Generation complete!');
                console.log('ASCII preview:', result.ascii.substring(0, 100));
            });

            eventBus.emit(EventBus.Events.REQUEST_TEXT_GENERATION, {
                text: 'TEST',
                fontName: 'standard',
                color: 'none',
                animation: 'none'
            });
        }

        function testManualDisplay() {
            clearConsole();
            console.log('üñºÔ∏è Testing manual display...');
            
            // Create a test output element
            let output = document.getElementById('test-output');
            if (!output) {
                output = document.createElement('pre');
                output.id = 'test-output';
                output.style.cssText = `
                    background: #111;
                    color: #0f0;
                    padding: 20px;
                    font-family: 'Courier New', monospace;
                    white-space: pre;
                    border: 2px solid #0f0;
                    margin: 20px 0;
                `;
                document.body.appendChild(output);
            }

            const testAscii = `
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
‚ïö‚ïê‚ïê‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù
   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïë   
   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   
   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   
   ‚ïö‚ïê‚ïù   ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù   ‚ïö‚ïê‚ïù   
            `;

            output.textContent = testAscii;
            console.log('‚úÖ ASCII displayed in test element');
            console.log('Can you see "TEST" above?');
        }

        // Auto-run on load
        window.addEventListener('load', () => {
            setTimeout(runFullDiagnostic, 500);
        });
    </script>
</body>
</html>

